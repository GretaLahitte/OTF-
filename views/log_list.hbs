{{> menu}}
<div class="container-fluid">
    <div class="row-fluid">
        <div class="col-xs-12 col-sm-12 col-md-12">
            <h3>List Logs</h3>
        </div>
    </div>
    <!-- Javascript d'initialisation d'un datatable jquery bootstrapisé -->
    <script>
        //<![CDATA[
        $(document).ready(function() {
            var aSelected = [];
            var clicked = false;
            var listIdSelected = "";
            var oldThis;
            var datas = {{{json result}}};
            tabJsonClient = new Array();
            /** Création de la table jquery pour afficher la liste des clients connectés sur le serveur */
            $("#monitor").html('<div class="panel-body"><div class="table-responsive"><table class="table table-striped table-bordered table-hover dataTable no-footer" id="listereponses"></table></div></div>');
            tabMonitor = $("#listereponses").dataTable({
                "bJQueryUI": true,
                "sPaginationType": "full_numbers",
                "aaData": tabJsonClient, //données du tableau datatable récupérer dans la listereponses
                "oTableTools": {
                    "sRowSelect": "single"
                },
                "aoColumns": [{ "sTitle": "No.", "sClass": "center"},
                    { "sTitle": "Date", "sClass": "center"},
                    { "sTitle": "Event", "sClass": "center"},
                    { "sTitle": "Session", "sClass": "center"},
                    { "sTitle": "Ip", "sClass": "center"},
                    { "sTitle": "Message", "sClass": "center"},
                    { "sTitle": "User Id", "sClass": "center"},
                    { "sTitle": "User Login", "sClass": "center"}
                ],
                "fnRowCallback": function( nRow, aData, iDisplayIndex ) {
                    //détecter un clic sur la ligne via un lien
                    $('td:eq(0)', nRow).html('<a href="#" onclick="callDetail(\''+$.trim(aData[0])+'\')">' + aData[0] + '</a>');
                    //return nRow;
                }
            });

            /* Click event handler */
            $(document).on("click", "#suppruve", function() {
                var reponse = confirm('ATTENTION : Voulez-vous vraiment supprimer l\'utilisateur N° : ' + aSelected);
                if (reponse) {
                    for(var j=0;j<aSelected.length;j++) {
                        $.get('/deletextrauser?_id='+aSelected[j], function (data) {
                            window.location.href='/listextrauser';
                        });
                    }
                }
            });

            $(document).on("click", "#listereponses > tbody > tr", function() {
                var iPos = tabMonitor.fnGetPosition( this );
                var aData = tabMonitor.fnGetData( iPos );
                var iId = aData[0];  // colonne 3 c'est l'uuid_tablette à la place de l'id base.
                // permet de récupérer la position de la valeur iId de aSelected
                var index = jQuery.inArray(iId, aSelected);
                if ( index === -1 ) {
                    aSelected.push( iId );
                } else {
                    aSelected.splice( index, 1 );
                }
                if (typeof oldThis != 'undefined') oldThis.toggleClass('row_selected');
                oldThis = $(this);
                $(this).toggleClass('row_selected');
            });

            $(document).on("dblclick", "#listereponses > tbody > tr", function() {
                $(this).toggleClass('row_selected');
                if (typeof oldThis != 'undefined') oldThis.toggleClass('row_selected');
                var idUve = tabMonitor.fnGetData(tabMonitor.fnGetPosition(this))[0];
                window.location.href='/modifextrauser?_id='+idUve;
            });


            for (var i=0;i<datas.length;i++) {
                tabJsonClient.push("[\'"+datas[i]._id+"\', \'"
                        +datas[i].date+"\', \'"
                        +datas[i].event+"\', \'"
                        +datas[i].session+"\', \'"
                        +datas[i].ip+"\', \'"
                        +datas[i].message+"\', \'"
                        +datas[i].user_id._id+"\', \'"
                        +datas[i].user_id.login+"\', \'"
                        +datas[i].__v+"\']");
                tabMonitor.fnAddData([datas[i]._id,datas[i].date,datas[i].event, datas[i].session, datas[i].ip, datas[i].message, datas[i].user_id._id,  datas[i].user_id.login, datas[i].__v]);
                tabMonitor.fnDraw(false);
            }
        });
        //]]>
    </script>

    <div class="row">
        <div class="col-lg-12">
            <div id="monitor" class="panel panel-default"></div>
        </div><!-- /.col-lg-12 -->
    </div>
    <!--div class="row-fluid">
        {{#each result}}
            <div class="row-fluid">
                <div class="col-xs-12 col-sm-8 col-md-4 col-lg-4">
                    <p>Id : {{_id}}</p>

                    <p>Date : {{date}}</p>

                    <p>Event : {{event}}</p>

                    <p>Session : {{session}}</p>

                    <p>Ip : {{ip}}</p>

                    <p>Message : {{message}}</p>

                    <p>User Id : {{user_id._id}}</p>

                    <p>User Login : {{user_id.login}}</p>
                    <hr>

                    <p></p>
                </div>
            </div>
        {{/each}}
    </div-->
</div>