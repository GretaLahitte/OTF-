#!/usr/bin/env node

//--
require('../ressources/oplog')();
//
var cookieParser = require('cookie-parser');
//--
// Logger Configuration
var log4js = require('log4js');
log4js.configure('./ressources/log4js.json', { reloadSecs: 300 });
mongoAppender = require('log4js-node-mongodb');
log4js.addAppender(
    mongoAppender.appender({connectionString: 'localhost:27017/logs'}),
    'cheese'
);

var logger = log4js.getLogger('ccs');
var loggerMongo = log4js.getLogger('mongo');
//--
var debug = require('debug')('OTF');
//--
var app = require('../app');
app.set('port', process.env.NODE_PORT || 3000);
app.set('host', process.env.NODE_HOST || "localhost");
//
var server = app.listen(app.get('port'), app.get('host'), function () {
    logger.debug("Express server listening on http://%s:%d \n", app.get('host'), app.get('port'));
    loggerMongo.debug("Express server listening on http://%s:%d \n", app.get('host'), app.get('port'));
});
// SERVER SOCKET
//
sio = require('socket.io')(server, {log: false});
//
sio.on('connection', function (socket) {
    //socket.broadcast.to(id).emit('my message', msg);
    console.log(" WS connection socket.id :" + socket.id);
    console.log(" WS connection cookie    : " + socket.request.headers.cookie);
    // console.log(" WS socket.io.engine.id    : "+socket.io.engine.id);
    // console.log(" WS connection request   : "+socket.upgradeReq);
    //socket.join(socket.io.engine.id);
    sio.sockets.in(socket.id).emit('ack', socket.id);
    console.log("Room nÂ° : " + socket.id);

});


//--

